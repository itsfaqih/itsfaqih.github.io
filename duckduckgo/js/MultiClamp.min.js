"use strict";!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.MultiClamp=t.MultiClamp||e()}(this,function(){function a(t){return parseInt(t,10)}function l(t){return(t+"").replace(/[^\d.]/g,"")-0}function p(t){return Math.round(100*t)/100}function h(t,e){return"textContent"in t?t.textContent=e:t.innerText=e}function o(t,e){return window.getComputedStyle?window.getComputedStyle(t,null).getPropertyValue(e):t.currentStyle.getAttribute(e.replace(/-(\w)/g,function(t,e){return e.toUpperCase()}))}function m(t){var e=o(t,"height");return-1<e.indexOf("px")?l(e):p(l(t.clientHeight)-l(o(t,"padding-top"))-l(o(t,"padding-bottom")))}var t=function(t,e){t&&(this.element=t.length?t[0]:t,this.originalOption=e||{},this.preInit(this.originalOption),this.init())};return t.prototype={constructor:t,reload:function(t){if(t){t.useOriginalText&&(this.element.innerHTML=this.contentHtml);var e={};for(var i in this.originalOption)e[i]=this.originalOption[i];for(var n in t)e[n]=t[n];this.preInit(e)}this.init()},preInit:function(t){if(this.option={ellipsis:"ellipsis"in t?t.ellipsis:"...",clamp:"clamp"in t?t.clamp:3,reverse:"reverse"in t&&!!t.reverse,splitByWords:"splitByWords"in t&&!!t.splitByWords,disableCssClamp:"disableCssClamp"in t&&!!t.disableCssClamp,onClampStart:"onClampStart"in t&&"function"==typeof t.onClampStart?t.onClampStart:function(){},onClampEnd:"onClampEnd"in t&&"function"==typeof t.onClampEnd?t.onClampEnd:function(){}},"lineTextLen"in t&&(this.option.lineTextLen=t.lineTextLen),"auto"===this.option.clamp)this.autoClamp=!0;else{if(this.option.clamp=a(this.option.clamp),isNaN(this.option.clamp)||this.option.clamp<1)throw new Error("Invaild clamp number!");this.autoClamp=!1}this.useCssClamp=!(this.option.disableCssClamp||this.autoClamp||this.option.reverse||this.option.splitByWords||"..."!==this.option.ellipsis||void 0===document.body.style.webkitLineClamp)},init:function(){if(this.useCssClamp){var t={display:"-webkit-box",overflow:"hidden",textOverflow:"ellipsis",WebkitLineClamp:this.option.clamp,WebkitBoxOrient:"vertical"};for(var e in t)this.element.style[e]=t[e]}else this.contentHtml=this.element.innerHTML,this.contentText="textContent"in(i=this.element)?i.textContent:i.innerText,this.ellipsis=function(t){if(/^<[\w\W]+>$/.test(t)){var e=document.createElement("div");return e.innerHTML=t,e.firstElementChild||e.firstChild}return t}(this.option.ellipsis),this.clamp();var i},getSingleLineHeight:function(){var t=o(this.element,"line-height"),e=this;if(-1<t.indexOf("px"))return l(t);if(isNaN(t))return n();var i=o(this.element,"font-size");return-1<i.indexOf("px")?p(l(i)*t):-1<i.indexOf("pt")?p(4*l(i)/3*t):n();function n(){e.element.innerHTML=".";var t=m(e.element);return e.element.innerHTML=e.contentHtml,t}},clamp:function(){var t,e,i,n=this;if(t=this.getSingleLineHeight(),""!==this.contentText&&t){if(this.autoClamp?(i=m(this.element),this.option.clamp=a(i/t),this.originalHeightStyle=this.element.style.height,this.element.style.height="auto"):i=p(t*this.option.clamp),!(e=m(this.element))||!i||e<=i)return this.autoClamp&&(this.element.style.height=this.originalHeightStyle),void r();var l=this.option.onClampStart.call(this,{needClamp:!0});if(void 0===l||l){var o=this.option.splitByWords?this.contentText.match(/\w+|\W+?/g):this.contentText,s=a(this.option.lineTextLen||Math.min(20,this.contentText.length/this.option.clamp))*this.option.clamp;this.trunkSlice(o,i,s,s,!1),this.autoClamp&&(this.element.style.height=this.originalHeightStyle),this.option.onClampEnd.call(this,{didClamp:!0})}else this.autoClamp&&(this.element.style.height=this.originalHeightStyle),r(!0)}else r();function r(t){t||n.option.onClampStart.call(n,{needClamp:!1}),n.option.onClampEnd.call(n,{didClamp:!1})}},trunkSlice:function(t,e,i,n,l){var o,s=this,r=this.option.reverse?t.slice(t.length-n):t.slice(0,n);if(p(this.option.splitByWords?r.join(""):r),m(this.element)>e)o=l?i:a(i/2)||1,this.trunkSlice(t,e,o,n-o,!0);else{if(1===i&&l)return void(this.option.splitByWords&&/\s/.test(r[this.option.reverse?0:r.length-1])&&p((this.option.reverse?r.slice(1):r.slice(0,r.length-1)).join("")));o=l?a(i/2)||1:i,this.trunkSlice(t,e,o,n+o,!1)}function p(t){"object"==typeof s.ellipsis?(h(s.element,t),s.option.reverse?s.element.insertBefore(s.ellipsis.cloneNode(!0),s.element.firstChild):s.element.appendChild(s.ellipsis.cloneNode(!0))):s.option.reverse?h(s.element,s.ellipsis+t):h(s.element,t+s.ellipsis)}}},t});